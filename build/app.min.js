(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var FakeStorage=function(){function FakeStorage(){_classCallCheck(this,FakeStorage);this.data={}}_createClass(FakeStorage,[{key:"setItem",value:function setItem(id,val){this.data[id]=String(val)}},{key:"getItem",value:function getItem(id){return Object.prototype.hasOwnProperty.call(this.data,id)?this.data[id]:undefined}}]);return FakeStorage}();var LocalStorage=function(){function LocalStorage(){_classCallCheck(this,LocalStorage);var supported=LocalStorage.localStorageSupported();this.storage=supported?window.localStorage:new FakeStorage}_createClass(LocalStorage,[{key:"getBestScore",value:function getBestScore(id){return this.storage.getItem(id)||0}},{key:"setBestScore",value:function setBestScore(id,score){var current=parseInt(this.getBestScore(id),10);if(!current||score<current){this.storage.setItem(id,score)}}}],[{key:"localStorageSupported",value:function localStorageSupported(){try{var testKey="test";var storage=window.localStorage;storage.setItem(testKey,"1");storage.removeItem(testKey);return true}catch(error){return false}}}]);return LocalStorage}();exports.default=LocalStorage},{}],2:[function(require,module,exports){"use strict";var _mineslitter=require("./mineslitter");var _mineslitter2=_interopRequireDefault(_mineslitter);var _localStorage=require("./localStorage");var _localStorage2=_interopRequireDefault(_localStorage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function isMobile(){var isAndroid=function isAndroid(){return navigator.userAgent.match(/Android/i)};var isBlackBerry=function isBlackBerry(){return navigator.userAgent.match(/BlackBerry/i)};var isiOS=function isiOS(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)};var isOpera=function isOpera(){return navigator.userAgent.match(/Opera Mini/i)};var isWindows=function isWindows(){return navigator.userAgent.match(/IEMobile/i)};return isAndroid()||isiOS()||isBlackBerry()||isOpera()||isWindows()}function main(){var canvas=document.getElementById("canvas");var context=canvas.getContext("2d");var gameContainer=document.querySelector(".game-container");var mobile=isMobile();var mineslitter=new _mineslitter2.default(context,mobile?3:2);var localStorage=new _localStorage2.default;var currentGame=0;if(mobile){var rows=document.querySelectorAll(".hide-for-mobile");for(var i=0;i<rows.length;i++){rows[i].style.display="none"}}else{document.querySelector(".empty_class").style.display="none"}mineslitter.onsize=function(width,height){canvas.width=width;canvas.height=height};var displayScore=function displayScore(id){var score=localStorage.getBestScore(id);document.getElementById("best"+id).innerHTML=score?score/1e3:"-"};mineslitter.onwin=function(score){localStorage.setBestScore(currentGame,score);displayScore(currentGame)};var radioClick=function radioClick(id){var width=[9,16,30];var height=[9,16,16];var radio=document.getElementById("mines"+id);var minesCount=parseInt(radio.labels[0].innerText,10);var sizeClass=id/3|0;mineslitter.newGame(width[sizeClass],height[sizeClass],minesCount,gameContainer.offsetWidth);currentGame=id};radioClick(0);var _loop=function _loop(_i){document.getElementById("mines"+_i).onclick=function(){return radioClick(_i)};displayScore(_i)};for(var _i=0;_i<9;_i++){_loop(_i)}if(mobile){var offsetX=function offsetX(){return canvas.offsetParent.offsetLeft+canvas.offsetLeft};var offsetY=function offsetY(){return canvas.offsetParent.offsetTop+canvas.offsetTop};document.addEventListener("touchend",function(event){var _event$changedTouches=event.changedTouches[0],pageX=_event$changedTouches.pageX,pageY=_event$changedTouches.pageY;mineslitter.mouseUp(pageX-offsetX(),pageY-offsetY())},false);document.addEventListener("touchstart",function(event){var _event$changedTouches2=event.changedTouches[0],pageX=_event$changedTouches2.pageX,pageY=_event$changedTouches2.pageY;mineslitter.mouseDown(pageX-offsetX(),pageY-offsetY(),document.getElementById("empty_mode").checked?2:0)},false)}else{canvas.addEventListener("mouseup",function(event){mineslitter.mouseUp(event.offsetX,event.offsetY)},false);canvas.addEventListener("mousedown",function(event){mineslitter.mouseDown(event.offsetX,event.offsetY,event.button)},false)}canvas.oncontextmenu=function(e){e.preventDefault();e.stopPropagation()}}window.addEventListener("load",main)},{"./localStorage":1,"./mineslitter":3}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Tile=function(){function Tile(x,y){_classCallCheck(this,Tile);this.x=x;this.y=y;this.value=0;this.mine=false;this.empty=false}_createClass(Tile,[{key:"draw",value:function draw(ctx,img,scale,count,max_count,win){var _this=this;var draw=function draw(sx,sy){ctx.drawImage(img,sx,sy,48,48,12+16*_this.x*scale,55+16*_this.y*scale,16*scale,16*scale)};if(count===this.value){if(this.mine)win?draw(48*9,48):draw(48*this.value,48*2);else draw(48*this.value,0)}else if(count<this.value){if(this.mine)draw(48*this.value,48*2);else if(this.empty){if(max_count>=this.value)draw(48*this.value,0);else draw(48*this.value,48*3)}else draw(48*this.value,48)}else if(this.mine)draw(48*9,48*3);else draw(48*this.value,48*3)}}]);return Tile}();var Mineslitter=function(){function Mineslitter(context,scale){_classCallCheck(this,Mineslitter);this.context=context;this.myscale=scale;this.onsize=function(){};this.onwin=function(){};this.img_skin=document.getElementById("skin");this.img_tiles=document.getElementById("tiles")}_createClass(Mineslitter,[{key:"newGame",value:function newGame(width,height,mines,maxwidth){this.stopGame();this.game_over=false;this.width=width;this.height=height;this.maxwidth=maxwidth;this.mines=mines;this.mines_left=this.mines;this.scale=Math.min(this.myscale,(maxwidth-24)/(this.width*16));this.onsize(this.width*16*this.scale+24,this.height*16*this.scale+67);this.startGame();this.draw()}},{key:"startGame",value:function startGame(){var _this2=this;this.generate();this.startTime=Date.now();this.timerId=setInterval(function(){return _this2.drawTime()},100)}},{key:"stopGame",value:function stopGame(){if(this.timerId)clearInterval(this.timerId);this.timerId=0}},{key:"adjacentTiles",value:function adjacentTiles(tile,callback){for(var x=tile.x-1;x<=tile.x+1;x++){for(var y=tile.y-1;y<=tile.y+1;y++){if(x>=0&&x<this.width&&y>=0&&y<this.height){callback(this.tiles[x+y*this.width])}}}}},{key:"generate",value:function generate(){var _this3=this;var rand=function rand(n){return Math.random()*n|0};var mines=new Array(this.width*this.height);for(var i=0;i<this.mines;i++){var ind=rand(this.width*this.height);if(mines[ind])i--;else mines[ind]=true}this.tiles=new Array(this.width*this.height);for(var _i=0;_i<this.tiles.length;_i++){var x=_i%this.width|0;var y=_i/this.width|0;this.tiles[_i]=new Tile(x,y)}this.tiles.forEach(function(tile){var count=0;_this3.adjacentTiles(tile,function(next){var ind=next.x+next.y*_this3.width;if(mines[ind])count++});var ind=tile.x+tile.y*_this3.width;_this3.tiles[ind].value=count});this.tiles.forEach(function(tile){var count=0;_this3.adjacentTiles(tile,function(){return count++});if(count===tile.value){_this3.adjacentTiles(tile,function(next){var ind=next.x+next.y*_this3.width;_this3.tiles[ind].mine=true;_this3.mines_left--})}})}},{key:"adjacentCount",value:function adjacentCount(tile){var count=0;this.adjacentTiles(tile,function(next){if(next.mine)count++});return count}},{key:"checkWin",value:function checkWin(){var _this4=this;var countProperlyTile=0;this.tiles.forEach(function(tile){var count=_this4.adjacentCount(tile);if(count===tile.value)countProperlyTile++});if(countProperlyTile===this.width*this.height){this.stopGame();this.onwin(Date.now()-this.startTime);this.tiles.forEach(function(tile){tile.draw(_this4.context,_this4.img_tiles,_this4.scale,tile.value,tile.value,true)});this.game_over=true;this.drawSmile(4)}}},{key:"drawNumber",value:function drawNumber(number,pos){var _this5=this;var clamp=function clamp(value,min,max){return Math.min(Math.max(value,min),max)};var num=clamp(number,0,999);var elem=new Array(3);elem[0]=num/100|0;elem[1]=num/10%10|0;elem[2]=num%10|0;var posx=pos;elem.forEach(function(e){_this5.drawRect(94+e*13,0,13,23,posx,17,13,23);posx+=13})}},{key:"drawSmile",value:function drawSmile(state){this.drawRect(52+26*state,25,26,26,this.width*8*this.scale-1,16,26,26)}},{key:"drawMinesLeft",value:function drawMinesLeft(){this.drawNumber(this.mines_left,17)}},{key:"drawTime",value:function drawTime(){var time=Date.now()-this.startTime;var sec=time/1e3|0;this.drawNumber(sec,12+this.width*16*this.scale-4-40)}},{key:"drawRect",value:function drawRect(sx,sy,swidth,sheight,dx,dy,dwidth,dheight){this.context.drawImage(this.img_skin,sx,sy,swidth,sheight,dx,dy,dwidth,dheight)}},{key:"drawTile",value:function drawTile(tile){var _this6=this;var count=this.adjacentCount(tile);var max_count=count;this.adjacentTiles(tile,function(next){var next_count=_this6.adjacentCount(next);if(next_count<next.value){if(!next.mine&&!next.empty)max_count++}});tile.draw(this.context,this.img_tiles,this.scale,count,max_count,false)}},{key:"draw",value:function draw(){var _this7=this;this.drawRect(0,0,12,55,0,0,12,55);this.drawRect(40,0,12,55,this.width*16*this.scale+12,0,12,55);this.drawRect(12,0,20,55,12,0,this.width*16*this.scale,55);this.drawRect(0,72,12,12,0,55+this.height*16*this.scale,12,12);this.drawRect(20,72,12,12,this.width*16*this.scale+12,55+this.height*16*this.scale,12,12);this.drawRect(0,56,12,10,0,55,12,this.height*16*this.scale);this.drawRect(12,72,8,12,12,55+this.height*16*this.scale,this.width*16*this.scale,12);this.drawRect(20,64,12,8,this.width*16*this.scale+12,55,12,this.height*16*this.scale);this.drawRect(52,0,41,25,16,16,41,25);this.drawRect(52,0,41,25,12+this.width*16*this.scale-4-41,16,41,25);this.tiles.forEach(function(tile){return _this7.drawTile(tile)});this.drawMinesLeft();this.drawTime();this.drawSmile(0)}},{key:"isSmile",value:function isSmile(x,y){return x>this.width*8*this.scale-1&&x<this.width*8*this.scale-1+26&&y>16&&y<16+26}},{key:"mouseDown",value:function mouseDown(x,y,button){var _this8=this;var smile=this.isSmile(x,y);if(smile){this.drawSmile(1);return}if(this.game_over)return;if(!smile)this.drawSmile(2);var floatX=(x-12)/(16*this.scale);var floatY=(y-55)/(16*this.scale);if(floatX>=0&&floatX<this.width&&floatY>=0&&floatY<this.height){var indX=floatX|0;var indY=floatY|0;var tile=this.tiles[indX+indY*this.width|0];if(tile.value!==9){if(button===0){tile.mine=!tile.mine;if(tile.mine)this.mines_left--;else this.mines_left++;this.drawMinesLeft()}else if(button===2)tile.empty=!tile.empty;else return;this.tiles.forEach(function(tile){return _this8.drawTile(tile)});this.checkWin()}}}},{key:"mouseUp",value:function mouseUp(x,y){if(this.isSmile(x,y)){this.drawSmile(0);this.newGame(this.width,this.height,this.mines,this.maxwidth)}if(this.game_over)return;this.drawSmile(0)}}]);return Mineslitter}();exports.default=Mineslitter},{}]},{},[2]);